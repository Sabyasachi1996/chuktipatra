
function callSignOut(){
    var params= {flag:"adminLogout"}
    $.ajax({
        url: BASE_URL + "admin/logout",
        type: "post",
        data: params,
        dataType: "json",
        headers: {
            "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content"),
        },
        cache: false,
        beforeSend: function () {
        },
        success: function (response) {
            if (response.error) {
                $(".btn-admin-login-send-otp").attr("disabled", false);
                showSnacBar(response.message, "error");
                setTimeout(function(){
                 location.reload();
                },1500);
            } else {
                sessionStorage.clear();
                showSnacBar(response.message, "success");
                setTimeout(function(){
                    location.href=BASE_URL+"admin"
                },1500);
            }
        },
    }); 
}
//admin login send otp
$(document).on("click", ".btn-admin-login-send-otp", function () {
    var error = false;
    var adminPhone  =   getValById("adminPhone");
    var random      =   $('meta[name="random-key"]').attr("content");

    hideError("adminPhone");

    if (adminPhone == "" || adminPhone.length < 10 || !validateMobile(adminPhone)) {
        error = true;
        showError("adminPhone", "Please enter valid mobile number");
    }

    if (!error) {
        var params = { adminPhone: encryptByAES(adminPhone, random) , random: random};
        $.ajax({
            url: BASE_URL + "admin/admin-login-send-otp",
            type: "post",
            data: params,
            dataType: "json",
            headers: {
                "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content"),
            },
            cache: false,
            beforeSend: function () {
                $(".btn-admin-login-send-otp").attr("disabled", true);
            },
            success: function (response) {
                if (response.error) {
                    $(".btn-admin-login-send-otp").attr("disabled", false);
                    showSnacBar(response.message, "error");
                    setTimeout(function(){
                     location.reload();
                    },1500);
                } else {
                    $('.adminLoginSt1').removeClass('show').addClass('hide');
                    $('.adminLoginSt2').removeClass('hide').addClass('show');
                    $('.btn-admin-login-send-otp').removeClass('show').addClass('hide');
                    $('.btn-admin-login-verify-otp').removeClass('hide').addClass('show');
                    $('#adminOTP').val(response.otp);
                    showSnacBar(response.message, "success");
                }
            },
        }); 
    }
});        
// adminLoginSt1  adminLoginSt2  btn-admin-login-send-otp  btn-admin-login-verify-otp
//admin login verify otp
$(document).on("click", ".btn-admin-login-verify-otp", function () {
    var error = false;
    var adminPhone  =   getValById("adminPhone");
    var adminOTP   =   getValById("adminOTP");
    var random          =   $('meta[name="random-key"]').attr("content");

    hideError("adminOTP");

    if (adminOTP == "" || adminOTP.length < 6) {
        error = true;
        showError("adminOTP", "Please enter valid OTP");
    }

    if (!error) {
        var params = {adminPhone:encryptByAES(adminPhone,random), adminOTP: adminOTP,random:random };
        $.ajax({
            url: BASE_URL + "admin/admin-login-verify-otp",
            type: "post",
            data: params,
            dataType: "json",
            headers: {
                "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content"),
            },
            cache: false,
            beforeSend: function () {
                $(".btn-admin-login-verify-otp").attr("disabled", true);
            },
            success: function (response) {
                if (response.error) {
                    showSnacBar(response.message, "error");
                    setTimeout(function(){
                        location.reload();
                    },1200);
                } else {
                    sessionStorage.setItem("adminPhone",response.adminPhone);
                    sessionStorage.setItem("adminName",response.adminName);
                    sessionStorage.setItem("adminLogin",response.adminLogin);
                    sessionStorage.setItem("adminId",response.adminId);
                    showSnacBar(response.message, "success");
                    window.setTimeout(function () {
                        location.href = BASE_URL + "admin/dashboard";
                    }, 3000);
                    
                }
            },
        });
    }
});
//admin logout  
$(document).on("click",".btn-admin-logout",function(){
    console.log("passing here");
    Swal.fire({
        title: "You will be logged out.",
        text: "You will be logged out unless you click on another link.",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#2d2202",
        cancelButtonColor: "#bcbcbc",
        confirmButtonText: "Yes, logout!",
    }).then((result) => {
        if (result.isConfirmed) {
            callSignOut()
        } else {
           location.reload();
        }
    });
});
